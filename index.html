<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2c3e50">
    <title>Sistema de Gest√£o de Demandas - Supervis√£o Escolar</title>
    
    <!-- √çcone PWA -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="public/icons/192x192.png">
    
    <!-- Manifesto PWA -->
    <link rel="manifest" href="public/manifest.json">
    
    <!-- CSS -->
    <link rel="stylesheet" href="src/css/style.css">
    
    <!-- √çcones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Fonte -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        .user-details {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-logout {
            background: none;
            border: 1px solid #7f8c8d;
            color: #7f8c8d;
            cursor: pointer;
            padding: 5px 12px;
            border-radius: 4px;
            transition: all 0.3s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-logout:hover {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            border-color: #e74c3c;
        }
        
        .btn-admin {
            background: none;
            border: 1px solid #27ae60;
            color: #27ae60;
            cursor: pointer;
            padding: 5px 12px;
            border-radius: 4px;
            transition: all 0.3s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-admin:hover {
            background: rgba(39, 174, 96, 0.1);
            color: #27ae60;
            border-color: #27ae60;
        }
        
        /* Estilos para o bloco de demandas */
        .demandas-info {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
            margin-bottom: 25px;
            color: white;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .demandas-info::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }
        
        .demandas-info::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            transform: translate(-30%, 30%);
        }
        
        .demandas-info h2 {
            margin: 0 0 20px 0;
            font-size: 24px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            z-index: 2;
        }
        
        .demandas-info h2 i {
            color: #3498db;
            background: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .demandas-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            position: relative;
            z-index: 2;
        }
        
        .demanda-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 18px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .demanda-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .demanda-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
            flex-shrink: 0;
        }
        
        .demanda-icon.total { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        .demanda-icon.pendente { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .demanda-icon.andamento { background: linear-gradient(135deg, #3498db, #2980b9); }
        .demanda-icon.concluida { background: linear-gradient(135deg, #27ae60, #229954); }
        .demanda-icon.atrasada { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        
        .demanda-content {
            flex: 1;
        }
        
        .demanda-label {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 5px;
            display: block;
        }
        
        .demanda-value {
            font-size: 28px;
            font-weight: 700;
            display: block;
            line-height: 1;
        }
        
        /* Estilos para a lista de demandas */
        .demandas-lista-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 20px;
            margin-top: 20px;
        }
        
        .demanda-linha {
            display: grid;
            grid-template-columns: 2fr 1.5fr 1fr 1fr 1fr auto;
            gap: 15px;
            padding: 18px 15px;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .demanda-linha:hover {
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .demanda-linha.cabecalho {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
            border-radius: 8px 8px 0 0;
            border-bottom: 2px solid #3498db;
            font-size: 14px;
        }
        
        .demanda-titulo {
            font-weight: 500;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .demanda-escola, .demanda-departamento, .demanda-responsavel, .demanda-prazo {
            color: #555;
            font-size: 14px;
        }
        
        .demanda-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            min-width: 100px;
        }
        
        .status-pendente { background: #fff3cd; color: #856404; }
        .status-andamento { background: #d1ecf1; color: #0c5460; }
        .status-concluida { background: #d4edda; color: #155724; }
        .status-atrasada { background: #f8d7da; color: #721c24; }
        
        @media (max-width: 1200px) {
            .demanda-linha {
                grid-template-columns: 2fr 1fr 1fr 1fr auto;
            }
            .demanda-departamento {
                display: none;
            }
        }
        
        @media (max-width: 992px) {
            .demanda-linha {
                grid-template-columns: 2fr 1fr 1fr auto;
            }
            .demanda-responsavel {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .demandas-list {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .demanda-linha {
                grid-template-columns: 1fr auto;
                padding: 15px;
                gap: 10px;
            }
            
            .demanda-escola, .demanda-departamento, .demanda-responsavel, .demanda-prazo {
                display: none;
            }
        }
        
        @media (max-width: 576px) {
            .demandas-list {
                grid-template-columns: 1fr;
            }
            
            .demandas-info {
                padding: 20px;
            }
            
            .demanda-item {
                padding: 15px;
            }
        }
    </style>

</head>
<body>
    <!-- SPLASH SCREEN (logo ap√≥s o body) -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <div class="splash-logo">
                <i class="fas fa-school"></i>
            </div>
            <h1 class="splash-title">Sistema de Gest√£o de Demandas</h1>
            <p class="splash-subtitle">Supervis√£o Escolar - ES</p>
            <div class="splash-loader"></div>
            <p class="splash-status">Inicializando...</p>
        </div>
    </div>
    <!-- BARRA DE CARREGAMENTO -->
    <div class="loading-overlay" id="loading">
        <div class="loading-spinner"></div>
        <p>Carregando sistema...</p>
    </div>

    <!-- CONTAINER PRINCIPAL -->
    <div class="container" id="main-container">
        <!-- CABE√áALHO -->
        <header class="header">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-school"></i>
                </div>
                <div class="logo-text">
                    <h1>Sistema de Gest√£o de Demandas</h1>
                    <p>Supervis√£o Escolar - Estado do Esp√≠rito Santo</p>
                </div>
            </div>
             <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-user-tie"></i>
                </div>
                <div class="user-details">
                    <span class="user-name" id="user-name">Carregando...</span>
                    <span class="user-email" id="user-email"></span>
                    
                    <!-- Bot√£o para painel admin (vis√≠vel apenas para supervisor) -->
                    <button class="btn-admin" id="btn-admin" title="Painel do Supervisor" style="display: none;">
                        <i class="fas fa-user-shield"></i>
                    </button>
                    
                    <button class="btn-logout" id="btn-logout" title="Sair">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- BARRA DE CONTROLE -->
        <div class="control-bar">
            <div class="filtros">
                <div class="filtro-group">
                    <label for="filtro-escola"><i class="fas fa-school"></i> Escola:</label>
                    <select id="filtro-escola">
                        <option value="">Todas as escolas</option>
                        <option value="EEEFM Pedra Azul">EEEFM Pedra Azul</option>
                        <option value="EEEFM Fioravante Caliman">EEEFM Fioravante Caliman</option>
                        <option value="EEEFM Alto Rio Possmoser">EEEFM Alto Rio Possmoser</option>
                    </select>
                </div>
                
         <!-- FILTRO DEPARTAMENTO -->
         <div class="filtro-group">
             <label for="filtro-departamento"><i class="fas fa-building"></i> Departamento:</label>
             <select id="filtro-departamento">
                 <option value="">Todos os departamentos</option>
                 <option value="Gest√£o">Gest√£o</option>
                 <option value="Secretaria">Secretaria</option>
                 <option value="Pedag√≥gico">Pedag√≥gico</option>
                 <option value="Supervis√£o">Supervis√£o</option>
             </select>
         </div>
                <div class="filtro-group">
                    <label for="filtro-responsavel"><i class="fas fa-user-tag"></i> Respons√°vel:</label>
                    <select id="filtro-responsavel">
                        <option value="">Todos</option>
                        <option value="Supervisor">Supervisor</option>
                        <option value="Escola(s)">Escola(s)</option>
                    </select>
                </div>
                
                <div class="filtro-group">
                    <label for="filtro-status"><i class="fas fa-tasks"></i> Status:</label>
                    <select id="filtro-status">
                        <option value="">Todos</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Em andamento">Em andamento</option>
                        <option value="Conclu√≠da">Conclu√≠da</option>
                    </select>
                </div>
                
                <div class="filtro-group">
                    <label for="filtro-prazo"><i class="fas fa-calendar-alt"></i> Prazo:</label>
                    <select id="filtro-prazo">
                        <option value="">Todos</option>
                        <option value="hoje">Vencem hoje</option>
                        <option value="proximos">Pr√≥ximos 3 dias</option>
                        <option value="atrasadas">Atrasadas</option>
                    </select>
                </div>
                
                <button class="btn btn-secondary" id="btn-limpar-filtros">
                    <i class="fas fa-filter-circle-xmark"></i> Limpar Filtros
                </button>
            </div>
            
            <!-- BLOCO DE DEMANDAS -->
            <div class="demandas-info">
                <h2><i class="fas fa-chart-bar"></i> Demandas</h2>
                <div class="demandas-list">
                    <div class="demanda-item">
                        <div class="demanda-icon total">
                            <i class="fas fa-list-check"></i>
                        </div>
                        <div class="demanda-content">
                            <span class="demanda-label">Total</span>
                            <span class="demanda-value" id="total-demandas-info">15</span>
                        </div>
                    </div>
                    
                    <div class="demanda-item">
                        <div class="demanda-icon pendente">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="demanda-content">
                            <span class="demanda-label">Pendentes</span>
                            <span class="demanda-value" id="pendentes-info">5</span>
                        </div>
                    </div>
                    
                    <div class="demanda-item">
                        <div class="demanda-icon andamento">
                            <i class="fas fa-play-circle"></i>
                        </div>
                        <div class="demanda-content">
                            <span class="demanda-label">Em Andamento</span>
                            <span class="demanda-value" id="em-andamento-info">3</span>
                        </div>
                    </div>
                    
                    <div class="demanda-item">
                        <div class="demanda-icon concluida">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="demanda-content">
                            <span class="demanda-label">Conclu√≠das</span>
                            <span class="demanda-value" id="concluidas-info">6</span>
                        </div>
                    </div>
                    
                    <div class="demanda-item">
                        <div class="demanda-icon atrasada">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="demanda-content">
                            <span class="demanda-label">Atrasadas</span>
                            <span class="demanda-value" id="atrasadas-info">1</span>
                        </div>
                    </div>
                </div>
            </div>

        <!-- √ÅREA PRINCIPAL DE CONTE√öDO -->
        <main class="main-content">
            <!-- LISTA DE DEMANDAS -->
            <section class="demandas-section">
                <div class="section-header">
                    <h2><i class="fas fa-list-ul"></i> Lista de Demandas</h2>
                    <div class="section-actions">
                        <button class="btn btn-refresh" id="btn-atualizar">
                            <i class="fas fa-arrows-rotate"></i> Atualizar
                        </button>
                    </div>
                </div>
                
                <div class="demandas-lista-container" id="demandas-lista-container">
                <!-- CABE√áALHO DA LISTA -->
                <div class="demandas-lista-container">
                    <div class="demanda-linha cabecalho">
                        <div>T√≠tulo</div>
                        <div>Escola</div>
                        <div>Departamento</div>
                        <div>Respons√°vel</div>
                        <div>Prazo</div>
                        <div>Status</div>
                    </div>
                    
                    <!-- EXEMPLO DE DEMANDAS EM LISTA -->
                    <div class="demanda-linha">
                        <div class="demanda-titulo">
                            <i class="fas fa-file-alt" style="color: #3498db;"></i>
                            Entrega do relat√≥rio bimestral
                        </div>
                        <div class="demanda-escola">EEEFM Pedra Azul</div>
                        <div class="demanda-departamento">Pedag√≥gico</div>
                        <div class="demanda-responsavel">Escola(s)</div>
                        <div class="demanda-prazo">15/12/2024</div>
                        <div class="demanda-status status-pendente">Pendente</div>
                    </div>
                    
                    <div class="demanda-linha">
                        <div class="demanda-titulo">
                            <i class="fas fa-file-alt" style="color: #3498db;"></i>
                            Planejamento anual
                        </div>
                        <div class="demanda-escola">EEEFM Fioravante Caliman</div>
                        <div class="demanda-departamento">Gest√£o</div>
                        <div class="demanda-responsavel">Supervisor</div>
                        <div class="demanda-prazo">10/12/2024</div>
                        <div class="demanda-status status-andamento">Em Andamento</div>
                    </div>
                    
                    <div class="demanda-linha">
                        <div class="demanda-titulo">
                            <i class="fas fa-file-alt" style="color: #3498db;"></i>
                            Levantamento de materiais
                        </div>
                        <div class="demanda-escola">EEEFM Alto Rio Possmoser</div>
                        <div class="demanda-departamento">Secretaria</div>
                        <div class="demanda-responsavel">Escola(s)</div>
                        <div class="demanda-prazo">05/12/2024</div>
                        <div class="demanda-status status-concluida">Conclu√≠da</div>
                    </div>
                    
                    <div class="demanda-linha">
                        <div class="demanda-titulo">
                            <i class="fas fa-file-alt" style="color: #3498db;"></i>
                            Reuni√£o pedag√≥gica
                        </div>
                        <div class="demanda-escola">EEEFM Pedra Azul</div>
                        <div class="demanda-departamento">Supervis√£o</div>
                        <div class="demanda-responsavel">Supervisor</div>
                        <div class="demanda-prazo">01/12/2024</div>
                        <div class="demanda-status status-atrasada">Atrasada</div>
                    </div>
                    
                    <!-- MAIS DEMANDAS SER√ÉO ADICIONADAS VIA JAVASCRIPT -->
                </div>
                
                <!-- LISTA DE DEMANDAS (VERS√ÉO ANTIGA - MANTER PARA COMPATIBILIDADE) -->
                <div class="demandas-container" id="demandas-container" style="display: none;">
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list fa-3x"></i>
                        <h3>Nenhuma demanda cadastrada</h3>
                        <p>Clique no bot√£o "+" abaixo para criar sua primeira demanda</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- BOT√ÉO FLUTUANTE PARA NOVA DEMANDA -->
        <button class="btn-floating" id="btn-nova-demanda">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- MODAL DE NOVA DEMANDA -->
    <div class="modal-overlay" id="modal-nova-demanda">
        <div class="modal modal-large">
            <div class="modal-header">
                <h2><i class="fas fa-file-circle-plus"></i> Nova Demanda</h2>
                <button class="btn-close" id="btn-fechar-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="form-nova-demanda" novalidate>
                <div class="modal-body">
                    <!-- ABA PRINCIPAL -->
                    <div class="form-tabs">
                        <div class="tab active" data-tab="principal">Informa√ß√µes Principais</div>
                        <div class="tab" data-tab="email">Configura√ß√£o de E-mail</div>
                        <div class="tab" data-tab="anexos">Anexos</div>
                    </div>
                    
                    <!-- CONTE√öDO DAS ABAS -->
                    <div class="tab-content active" id="tab-principal">
                        <!-- Campo T√≠tulo - J√Å CORRIGIDO -->
                        <div class="form-group">
                            <label for="titulo"><i class="fas fa-heading"></i> T√≠tulo da Demanda *</label>
                            <input type="text" id="titulo" name="titulo" required placeholder="Ex: Entrega do relat√≥rio bimestral">
                        </div>
                        
                       <!-- Campo Descri√ß√£o - J√Å CORRIGIDO -->
                       <div class="form-group">
                           <label for="descricao"><i class="fas fa-align-left"></i> Descri√ß√£o Detalhada *</label>
                           <textarea id="descricao" name="descricao" rows="4" required placeholder="Descreva detalhadamente o que precisa ser feito..."></textarea>
                        </div>
                        
                        <!-- SELE√á√ÉO DE ESCOLAS -->
                        <div class="form-group">
                            <label><i class="fas fa-school"></i> Escolas Destino *</label>
                            <div class="escolas-container">
                                <div class="escola-option">
                                    <input type="checkbox" id="escola-todas" class="escola-checkbox">
                                    <label for="escola-todas" class="escola-label">
                                        <span class="escola-nome">Selecionar todas</span>
                                    </label>
                                </div>
                                
                                <!-- ESCOLAS PR√â-CADASTRADAS -->
                                <div class="escola-option">
                                    <input type="checkbox" id="escola-pedra-azul" 
                                           value="EEEFM Pedra Azul" class="escola-checkbox">
                                    <label for="escola-pedra-azul" class="escola-label">
                                        <span class="escola-nome">EEEFM Pedra Azul</span>
                                        <span class="escola-email">escolapedreiras@sedu.es.gov.br</span>
                                    </label>
                                </div>
                                
                                <div class="escola-option">
                                    <input type="checkbox" id="escola-fioravante" 
                                           value="EEEFM Fioravante Caliman" class="escola-checkbox">
                                    <label for="escola-fioravante" class="escola-label">
                                        <span class="escola-nome">EEEFM Fioravante Caliman</span>
                                        <span class="escola-email">escolafioravante@sedu.es.gov.br</span>
                                    </label>
                                </div>
                                
                                <div class="escola-option">
                                    <input type="checkbox" id="escola-possmoser" 
                                           value="EEEFM Alto Rio Possmoser" class="escola-checkbox">
                                    <label for="escola-possmoser" class="escola-label">
                                        <span class="escola-nome">EEEFM Alto Rio Possmoser</span>
                                        <span class="escola-email">escolapossmoser@sedu.es.gov.br</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- RESPONS√ÅVEL - CORRIGIDO COM checked -->
                        <div class="form-group">
                            <label><i class="fas fa-user-tag"></i> Respons√°vel pela Execu√ß√£o *</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="responsavel" value="Supervisor" required checked>
                                    <span class="radio-label supervisor">
                                        <i class="fas fa-user-tie"></i> Supervisor
                                    </span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="responsavel" value="Escola(s)" required>
                                    <span class="radio-label escola">
                                        <i class="fas fa-school"></i> Escola(s)
                                    </span>
                                </label>
                            </div>
                        </div>
                        <!-- SELE√á√ÉO DE DEPARTAMENTO(S) - APENAS PARA SUPERVISOR -->
                        <div class="form-group" id="departamento-container" style="display: none;">
                            <label><i class="fas fa-building"></i> Departamento(s) *</label>
                            <div class="departamentos-container">
                                <div class="departamento-option">
                                    <input type="checkbox" id="departamento-todas" class="departamento-checkbox">
                                    <label for="departamento-todas" class="departamento-label">
                                        <span class="departamento-nome">Selecionar todos</span>
                                    </label>
                                </div>
        
                                <div class="departamento-option">
                                    <input type="checkbox" id="departamento-gestao" 
                                           value="Gest√£o" class="departamento-checkbox">
                                    <label for="departamento-gestao" class="departamento-label">
                                        <span class="departamento-nome">Gest√£o</span>
                                    </label>
                                </div>
        
                                <div class="departamento-option">
                                    <input type="checkbox" id="departamento-secretaria" 
                                           value="Secretaria" class="departamento-checkbox">
                                    <label for="departamento-secretaria" class="departamento-label">
                                        <span class="departamento-nome">Secretaria</span>
                                    </label>
                                </div>
        
                                <div class="departamento-option">
                                    <input type="checkbox" id="departamento-pedagogico" 
                                           value="Pedag√≥gico" class="departamento-checkbox">
                                    <label for="departamento-pedagogico" class="departamento-label">
                                        <span class="departamento-nome">Pedag√≥gico</span>
                                    </label>
                                </div>
        
                                <div class="departamento-option">
                                    <input type="checkbox" id="departamento-supervisao" 
                                           value="Supervis√£o" class="departamento-checkbox">
                                    <label for="departamento-supervisao" class="departamento-label">
                                        <span class="departamento-nome">Supervis√£o</span>
                                    </label>
                                 </div>
                             </div>
                         </div>
                        
                        <!-- PRAZO - CORRIGIDO COM name -->
                        <div class="form-group">
                            <label for="prazo"><i class="fas fa-calendar-day"></i> Prazo Final *</label>
                            <input type="date" id="prazo" name="prazo" required 
                                   min="2024-01-01">
                        </div>
                    </div>
                    
                    <!-- ABA DE E-MAIL -->
                    <div class="tab-content" id="tab-email">
                        <div class="form-group">
                            <label class="checkbox-option">
                                <input type="checkbox" id="enviar-email">
                                <span>Enviar e-mail autom√°tico sobre esta demanda</span>
                            </label>
                            <small class="form-help">
                                Se marcado, um e-mail ser√° enviado para as escolas selecionadas e c√≥pia para a supervis√£o.
                            </small>
                        </div>
                        
                        <div class="email-content" id="email-content" style="display: none;">
                            <div class="form-group">
                                <label for="corpo-email"><i class="fas fa-envelope"></i> Corpo do E-mail (Opcional)</label>
                                <textarea id="corpo-email" rows="6"
                                          placeholder="Digite a mensagem que ser√° enviada por e-mail..."></textarea>
                                <small class="form-help">
                                    Esta mensagem ser√° inclu√≠da no e-mail autom√°tico junto com os dados da demanda.
                                </small>
                            </div>
                            
                            <div class="email-preview">
                                <h4><i class="fas fa-eye"></i> Pr√©via do E-mail:</h4>
                                <div class="preview-content" id="email-preview">
                                    <p>Assunto: <span id="preview-assunto">[T√≠tulo da demanda]</span></p>
                                    <p>Destinat√°rios: <span id="preview-destinatarios">Escolas selecionadas + Supervis√£o</span></p>
                                    <p>Incluir√°: T√≠tulo, descri√ß√£o, escolas, respons√°vel, prazo e anexos (se houver).</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ABA DE ANEXOS -->
                    <div class="tab-content" id="tab-anexos">
                        <div class="form-group">
                            <label><i class="fas fa-paperclip"></i> Anexar Arquivos</label>
                            <div class="upload-area" id="upload-area">
                                <i class="fas fa-cloud-upload-alt fa-3x"></i>
                                <p>Arraste arquivos aqui ou clique para selecionar</p>
                                <small>Formatos suportados: PDF, DOC, XLS, PPT, JPG, PNG (M√°x. 10MB)</small>
                                <input type="file" id="file-input" multiple 
                                       accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png">
                            </div>
                            
                            <div class="arquivos-list" id="arquivos-list">
                                <!-- Lista de arquivos ser√° inserida aqui -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="btn-cancelar">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary" id="btn-salvar">
                        <i class="fas fa-save"></i> Salvar Demanda
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL DE DETALHES DA DEMANDA -->
    <div class="modal-overlay" id="modal-detalhes">
        <div class="modal modal-large">
            <!-- Conte√∫do ser√° preenchido via JavaScript -->
        </div>
    </div>

    <!-- MENSAGENS DO SISTEMA -->
    <div class="toast-container" id="toast-container"></div>

    <!-- SCRIPTS -->
    <script src="src/js/googleAppsScript.js"></script>
    <script src="src/js/googleSheets.js"></script>
    <!-- <script src="pushNotifications.js"></script> -->
    <script src="src/js/app.js"></script>
    


    <!-- SERVICE WORKER REGISTRATION -->
    <script>
    // ============================================
    // CONFIGURA√á√ÉO √öNICA E CORRETA PARA GITHUB PAGES
    // ============================================

    const APP_PATH = '/sistema-demandas-escolares/';

    // 1. Corrigir URL se necess√°rio
    if (!window.location.pathname.startsWith(APP_PATH) && 
        !window.location.hostname.includes('localhost') && 
        window.location.hostname !== '127.0.0.1') {
      
      const newUrl = window.location.origin + APP_PATH + 
                     window.location.pathname.replace(/^\//, '') + 
                     window.location.search + 
                     window.location.hash;
      
      window.history.replaceState(null, null, newUrl);
      console.log('‚úÖ URL corrigida para GitHub Pages:', newUrl);
    }

    // 2. Registrar Service Worker com caminho correto
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            // CAMINHO ABSOLUTO para GitHub Pages
            const swPath = APP_PATH + 'sw-notificacoes.js';
            
            navigator.serviceWorker.register(swPath)
                .then(function(registration) {
                    console.log('‚úÖ Service Worker registrado:', registration.scope);
                    
                    // Verificar atualiza√ß√µes
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        console.log('üîÑ Nova vers√£o do Service Worker dispon√≠vel');
                        
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                console.log('üÜï Nova vers√£o pronta! Recarregue para atualizar.');
                            }
                        });
                    });
                })
                .catch(function(error) {
                    console.error('‚ùå Erro no Service Worker:', error);
                });
        });
    }

    // 3. Inicializa√ß√£o da aplica√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
        // ============================================
// VERIFICA√á√ÉO DE LOGIN - BLOQUEAR ACESSO SEM LOGIN
// ============================================

// Verificar se o usu√°rio est√° logado
const usuarioSalvo = localStorage.getItem('usuario_demandas');
if (!usuarioSalvo) {
    // Se N√ÉO est√° logado, redirecionar para login
    console.log('üö´ Usu√°rio n√£o logado - Redirecionando para login');
    window.location.href = 'login.html';
    return; // Para a execu√ß√£o aqui
}

// Se est√° logado, carregar dados do usu√°rio
let usuario = null;
try {
    usuario = JSON.parse(usuarioSalvo);
    console.log('‚úÖ Usu√°rio logado:', usuario.nome);
    console.log('üéØ Tipo:', usuario.tipo_usuario);
    console.log('üè´ Escola:', usuario.escola_sre);
    console.log('üè¢ Departamento:', usuario.departamento);
} catch (e) {
    console.error('‚ùå Erro ao carregar usu√°rio:', e);
    localStorage.removeItem('usuario_demandas');
    window.location.href = 'login.html';
    return;
}
        // ============================================
        // ATUALIZAR INTERFACE COM DADOS DO USU√ÅRIO
        // ============================================

        // Atualizar nome e email no cabe√ßalho
        if (usuario) {
            const userName = document.getElementById('user-name');
            const userEmail = document.getElementById('user-email');
            
            if (userName) userName.textContent = usuario.nome || 'Usu√°rio';
            if (userEmail) userEmail.textContent = usuario.email || '';
            
            // Mostrar tipo de usu√°rio no t√≠tulo
            console.log('üë§ Tipo de usu√°rio detectado:', usuario.tipo_usuario);
            
            // Verificar permiss√µes e ajustar interface
           if (usuario && usuario.tipo_usuario) {
        ajustarInterfacePorTipoUsuario(usuario.tipo_usuario);
    }
}
        // Configurar bot√£o de logout
        const btnLogout = document.getElementById('btn-logout');
        if (btnLogout) {
            btnLogout.addEventListener('click', function() {
                if (confirm('Deseja sair do sistema?')) {
                    localStorage.removeItem('usuario_demandas');
                    window.location.href = 'login.html';
                }
            });
        }

// ============================================
// FUN√á√ÉO PARA AJUSTAR INTERFACE POR TIPO DE USU√ÅRIO
// ============================================

function ajustarInterfacePorTipoUsuario(tipo) {
    console.log('üéõÔ∏è Ajustando interface para:', tipo);
    
    // Obter dados do usu√°rio logado
    const usuarioSalvo = localStorage.getItem('usuario_demandas');
    let usuario = null;
    try {
        usuario = usuarioSalvo ? JSON.parse(usuarioSalvo) : {};
    } catch (e) {
        console.error('‚ùå Erro ao ler usu√°rio:', e);
        return;
    }
    
    console.log('üë§ Dados do usu√°rio:', {
        nome: usuario.nome,
        tipo: usuario.tipo_usuario,
        escola: usuario.escola_sre,
        departamento: usuario.departamento
    });
    
    // Elementos da interface
    const btnNovaDemanda = document.getElementById('btn-nova-demanda');
    const filtroEscola = document.getElementById('filtro-escola');
    const filtroDepartamento = document.getElementById('filtro-departamento');
    const btnLimparFiltros = document.getElementById('btn-limpar-filtros');
    const userEmail = document.getElementById('user-email');
    
    // ============================================
    // REGRA 1: APENAS SUPERVISOR PODE CRIAR DEMANDAS
    // ============================================
    if (btnNovaDemanda) {
        if (tipo === 'supervisor') {
            btnNovaDemanda.style.display = 'flex';
            console.log('‚úÖ Supervisor: bot√£o "+" vis√≠vel');
        } else {
            btnNovaDemanda.style.display = 'none';
            console.log('üö´ N√£o-supervisor: bot√£o "+" oculto');
        }
    }
    
    // ============================================
    // REGRA 2: CONFIGURAR FILTRO DE DEPARTAMENTO
    // ============================================
    if (filtroDepartamento) {
        // Limpar op√ß√µes atuais
        filtroDepartamento.innerHTML = '';
        
        let opcoesDepartamento = [];
        
        if (tipo === 'supervisor') {
            // SUPERVISOR: V√™ TODOS os departamentos
            opcoesDepartamento = [
                { value: '', text: 'Todos os departamentos' },
                { value: 'Gest√£o', text: 'Gest√£o' },
                { value: 'Secretaria', text: 'Secretaria' },
                { value: 'Pedag√≥gico', text: 'Pedag√≥gico' },
                { value: 'Supervis√£o', text: 'Supervis√£o' }
            ];
            console.log('üëë Supervisor: acesso a TODOS departamentos (5)');
            
        } else if (tipo === 'gestor') {
            // DIRETOR(A): V√™ 3 departamentos (exceto Supervis√£o)
            opcoesDepartamento = [
                { value: '', text: 'Todos os departamentos' },
                { value: 'Gest√£o', text: 'Gest√£o' },
                { value: 'Secretaria', text: 'Secretaria' },
                { value: 'Pedag√≥gico', text: 'Pedag√≥gico' }
                // N√ÉO INCLUI Supervis√£o!
            ];
            console.log('üëî Diretor(a): acesso a 3 departamentos (exceto Supervis√£o)');
            
        } else if (tipo === 'comum') {
            // USU√ÅRIO COMUM: V√™ APENAS seu departamento
            const deptUsuario = usuario.departamento || 'Pedag√≥gico';
            
            opcoesDepartamento = [
                { value: deptUsuario, text: deptUsuario }
            ];
            
            // Filtro FIXO (n√£o pode mudar)
            filtroDepartamento.disabled = true;
            filtroDepartamento.title = 'Seu departamento √© fixo: ' + deptUsuario;
            console.log('üë§ Usu√°rio comum: acesso APENAS ao departamento', deptUsuario);
        }
        
        // Adicionar op√ß√µes ao select
        opcoesDepartamento.forEach(opcao => {
            const option = document.createElement('option');
            option.value = opcao.value;
            option.textContent = opcao.text;
            filtroDepartamento.appendChild(option);
        });
    }
    
    // ============================================
    // REGRA 3: CONFIGURAR FILTRO DE ESCOLA
    // ============================================
    if (filtroEscola) {
        if (tipo === 'supervisor') {
            // SUPERVISOR: V√™ TODAS as escolas
            console.log('üëë Supervisor: acesso a TODAS escolas');
            // J√° est√° configurado no HTML
        } else {
            // DIRETOR(A) e USU√ÅRIO COMUM: Escola FIXA
            const escolaUsuario = usuario.escola_sre || 'EEEFM Pedra Azul';
            
            // Limpar e definir apenas sua escola
            filtroEscola.innerHTML = `
                <option value="${escolaUsuario}">${escolaUsuario}</option>
            `;
            
            // Filtro FIXO (n√£o pode mudar)
            filtroEscola.disabled = true;
            filtroEscola.title = 'Sua escola √© fixa: ' + escolaUsuario;
            console.log('üè´ Escola fixa para', tipo + ':', escolaUsuario);
        }
    }
    
    // ============================================
    // REGRA 4: BOT√ÉO LIMPAR FILTROS
    // ============================================
    if (btnLimparFiltros) {
        if (tipo === 'supervisor') {
            btnLimparFiltros.disabled = false;
            btnLimparFiltros.title = 'Limpar todos os filtros';
            console.log('‚úÖ Supervisor: bot√£o limpar filtros habilitado');
        } else {
            btnLimparFiltros.disabled = true;
            btnLimparFiltros.title = 'Filtros s√£o fixos para seu tipo de usu√°rio';
            console.log('üö´ N√£o-supervisor: bot√£o limpar filtros desabilitado');
        }
    }
    
      // REGRA 5: MOSTRAR TIPO DE USU√ÅRIO NO CABE√áALHO
    if (userEmail) {
        let tipoTexto = '';
        
        if (tipo === 'supervisor') tipoTexto = 'Supervisor';
        else if (tipo === 'gestor') tipoTexto = 'Diretor(a)';
        else if (tipo === 'comum') tipoTexto = 'Usu√°rio';
        
        userEmail.textContent = `${tipoTexto} ‚Ä¢ ${usuario.escola_sre || ''}`;
        console.log('üìã Cabe√ßalho atualizado:', tipoTexto);
    }
    
    // REGRA 6: BOT√ÉO DO PAINEL ADMIN (APENAS SUPERVISOR)
    const btnAdmin = document.getElementById('btn-admin');
    if (btnAdmin) {
        if (tipo === 'supervisor') {
            btnAdmin.style.display = 'flex';
            btnAdmin.onclick = function() {
                window.location.href = 'admin.html';
            };
            console.log('üëë Supervisor: bot√£o admin vis√≠vel');
        } else {
            btnAdmin.style.display = 'none';
        }
    }
    
        console.log('‚úÖ Interface ajustada para tipo:', tipo);
}  // ‚Üê FIM DA FUN√á√ÉO ajustarInterfacePorTipoUsuario

// AGORA VEM O RESTO DO C√ìDIGO FORA DA FUN√á√ÉO
// A. Detectar se √© PWA instalado
if (window.matchMedia('(display-mode: standalone)').matches) {
    console.log('üì± Executando como PWA instalado');
    document.body.classList.add('pwa-mode');
}

// B. Configurar data do prazo no formul√°rio
const hoje = new Date();
const amanha = new Date(hoje);
amanha.setDate(hoje.getDate() + 1);

const prazoInput = document.getElementById('prazo');
if (prazoInput) {
    // Data m√≠nima: amanh√£
    prazoInput.min = amanha.toISOString().split('T')[0];
    
    // Data padr√£o: 7 dias √† frente
    const prazoPadrao = new Date(hoje);
    prazoPadrao.setDate(hoje.getDate() + 7);
    prazoInput.value = prazoPadrao.toISOString().split('T')[0];
    
    // Data m√°xima: 2 anos √† frente
    const maxDate = new Date(hoje);
    maxDate.setFullYear(hoje.getFullYear() + 2);
    prazoInput.max = maxDate.toISOString().split('T')[0];
}

console.log('‚úÖ Sistema configurado e pronto!');

// 4. Instala√ß√£o do PWA (apenas uma vez)
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    
    console.log('üì≤ PWA pronto para instala√ß√£o');
    
    // Mostrar bot√£o de instala√ß√£o ap√≥s 3 segundos (apenas se n√£o for PWA)
    setTimeout(() => {
        if (deferredPrompt && !window.matchMedia('(display-mode: standalone)').matches) {
            mostrarBotaoInstalacao();
        }
    }, 3000);
});

function mostrarBotaoInstalacao() {
    // Evitar m√∫ltiplos bot√µes
    if (document.querySelector('.btn-instalar-pwa')) return;
    
    const botao = document.createElement('button');
    botao.className = 'btn-instalar-pwa';
    botao.innerHTML = '<i class="fas fa-download"></i> Instalar App';
    botao.style.cssText = `
        position: fixed;
        bottom: 100px;
        right: 20px;
        background: #3498db;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 25px;
        font-size: 14px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 10000;
        display: flex;
        align-items: center;
        gap: 8px;
    `;
    
    botao.onclick = () => {
        botao.style.display = 'none';
        deferredPrompt.prompt();
        
        deferredPrompt.userChoice.then(choiceResult => {
            if (choiceResult.outcome === 'accepted') {
                console.log('‚úÖ PWA instalado com sucesso!');
            }
            deferredPrompt = null;
        });
    };
    
    document.body.appendChild(botao);
    
    // Remover ap√≥s 30 segundos
    setTimeout(() => {
        if (botao.parentNode) {
            botao.remove();
        }
    }, 30000);
}

window.addEventListener('appinstalled', () => {
    console.log('üéâ PWA instalado com sucesso!');
});

}); // ‚Üê FECHA O document.addEventListener('DOMContentLoaded')

    
    // Inicializa√ß√£o otimizada para PWA + Notifica√ß√µes
    document.addEventListener('DOMContentLoaded', function() {
        // 1. Registrar Service Worker (PWA)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sistema-demandas-escolares/sw-notificacoes.js', {
                
            }).then(function(registration) {
                console.log('‚úÖ Service Worker registrado:', registration.scope);
            }).catch(function(error) {
                console.log('‚ö†Ô∏è Service Worker falhou:', error);
            });
        }
        
        // 2. Inicializar sistema de notifica√ß√µes
        setTimeout(function() {
            if (window.PushNotificationSystem) {
                window.PushNotificationSystem.initialize().then(function(success) {
                    if (success) {
                        console.log('üîî Sistema de notifica√ß√µes inicializado');
                        
                        // Verificar permiss√£o e mostrar bot√£o se necess√°rio
                        const info = window.PushNotificationSystem.getInfo();
                        
                        // Se n√£o tem permiss√£o, mostrar aviso amig√°vel ap√≥s 5 segundos
                        if (info.permission === 'default') {
                            setTimeout(function() {
                                if (typeof window.mostrarAvisoNotificacoes === 'function') {
                                    window.mostrarAvisoNotificacoes();
                                }
                            }, 5000);
                        }
                    }
                });
            }
        }, 3000);
        
        // 3. Configurar bot√µes de notifica√ß√µes se existirem
        setTimeout(function() {
            const btnAtivarNotificacoes = document.getElementById('btn-activar-notificacoes');
            if (btnAtivarNotificacoes) {
                btnAtivarNotificacoes.addEventListener('click', function() {
                    if (window.PushNotificationSystem) {
                        window.PushNotificationSystem.requestPermission();
                    }
                });
            }
            
            // Bot√£o de teste
            const btnTestarNotificacao = document.getElementById('btn-testar-notificacao');
            if (btnTestarNotificacao) {
                btnTestarNotificacao.addEventListener('click', function() {
                    if (window.PushNotificationSystem) {
                        window.PushNotificationSystem.sendTestNotification();
                    }
                });
            }
        }, 1000);
    });
</script>
</body>
</html>
