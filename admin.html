<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2c3e50">
    <title>Painel do Supervisor | Sistema de Demandas</title>
    
    <!-- √çcone PWA -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="public/icons/192x192.png">
    
    <!-- Manifesto PWA -->
    <link rel="manifest" href="public/manifest.json">
    
    <!-- CSS -->
    <link rel="stylesheet" href="src/css/style.css">
    
    <!-- √çcones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Fonte -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* Estilos espec√≠ficos do painel admin */
        .admin-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .admin-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .admin-section h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .admin-table th,
        .admin-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .admin-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .admin-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-pendente {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-autorizado {
            background-color: #d4edda;
            color: #155724;
        }
        
        .tipo-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .tipo-supervisor {
            background-color: #d6eaf8;
            color: #21618c;
        }
        
        .tipo-gestor {
            background-color: #d5f4e6;
            color: #196f3d;
        }
        
        .tipo-comum {
            background-color: #fdebd0;
            color: #9c640c;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 13px;
            margin: 2px;
        }
        
        .btn-group {
            display: flex;
            gap: 5px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #bdc3c7;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
        }
        
        .admin-header h1 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #2c3e50;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .search-filter {
            margin-bottom: 20px;
        }
        
        .search-box {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px;
            max-width: 100%;
        }
        
        .filter-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .loading-admin {
            text-align: center;
            padding: 40px;
            color: #3498db;
        }
        
        @media (max-width: 768px) {
            .admin-container {
                padding: 10px;
            }
            
            .admin-section {
                padding: 15px;
            }
            
            .admin-table th,
            .admin-table td {
                padding: 8px;
                font-size: 14px;
            }
            
            .admin-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .nav-buttons {
                width: 100%;
                justify-content: center;
            }
            
            .search-box {
                width: 100%;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }
        /* üî• ADICIONE ESTE CSS - ANIMA√á√ïES PARA REMO√á√ÉO DE LINHA */
@keyframes fadeOutSlide {
    0% { 
        opacity: 1; 
        transform: translateX(0); 
        max-height: 100px;
        overflow: hidden;
    }
    100% { 
        opacity: 0; 
        transform: translateX(-100%); 
        max-height: 0;
        padding-top: 0;
        padding-bottom: 0;
        margin: 0;
        border: none;
        overflow: hidden;
    }
}

.removing-row {
    animation: fadeOutSlide 0.5s ease forwards !important;
    pointer-events: none;
    position: relative;
    z-index: 1;
}

.removing-row td {
    transition: all 0.5s ease;
    border-bottom-color: transparent !important;
}

/* Melhorar a apar√™ncia das tabelas */
.admin-table tbody tr {
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.admin-table tbody tr:hover {
    background-color: #f5f9ff !important;
    transform: translateX(2px);
}

/* Estado vazio com melhor visual */
#solicitacoes-empty, #usuarios-empty {
    transition: all 0.5s ease;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 2px dashed #dee2e6;
    border-radius: 12px;
    padding: 50px 20px;
}

#solicitacoes-empty i, #usuarios-empty i {
    color: #adb5bd;
    font-size: 64px;
    margin-bottom: 20px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

/* Bot√µes com feedback visual */
.btn-small {
    transition: all 0.2s ease !important;
    position: relative;
    overflow: hidden;
}

.btn-small:active {
    transform: scale(0.95);
}

.btn-small::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 5px;
    height: 5px;
    background: rgba(255, 255, 255, 0.5);
    opacity: 0;
    border-radius: 100%;
    transform: scale(1, 1) translate(-50%);
    transform-origin: 50% 50%;
}

.btn-small:focus:not(:active)::after {
    animation: ripple 1s ease-out;
}

@keyframes ripple {
    0% {
        transform: scale(0, 0);
        opacity: 0.5;
    }
    20% {
        transform: scale(25, 25);
        opacity: 0.3;
    }
    100% {
        opacity: 0;
        transform: scale(40, 40);
    }
}

/* Efeito de loading nos bot√µes */
.btn-loading {
    position: relative;
    color: transparent !important;
    pointer-events: none;
}

.btn-loading::after {
    content: '';
    position: absolute;
    width: 16px;
    height: 16px;
    top: 50%;
    left: 50%;
    margin-left: -8px;
    margin-top: -8px;
    border: 2px solid #fff;
    border-radius: 50%;
    border-right-color: transparent;
    animation: button-spinner 0.6s linear infinite;
}

@keyframes button-spinner {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}
/* üî• CORRE√á√ÉO PARA DROPDOWN NO CELULAR */
@media (max-width: 768px) {
    .filter-group {
        flex-direction: column !important;
        gap: 8px !important;
    }
    
    .filter-group select.search-box {
        width: 100% !important;
        max-width: 100% !important;
        margin-right: 0 !important;
    }
    
    /* Garantir que os dropdowns n√£o ultrapassem a tela */
    select.search-box {
        max-width: calc(100vw - 40px) !important;
        box-sizing: border-box !important;
    }
    
    /* Corre√ß√£o espec√≠fica para os dropdowns de filtro */
    #filter-tipo, #filter-departamento {
        font-size: 14px !important;
        padding: 10px 12px !important;
        height: 44px !important;
    }
    
    /* Ajustar o container de filtros */
    .search-filter {
        padding: 0 5px !important;
    }
}
    </style>
</head>
<body>
    <!-- SPLASH SCREEN -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <div class="splash-logo">
                <i class="fas fa-user-shield"></i>
            </div>
            <h1 class="splash-title">Painel do Supervisor</h1>
            <p class="splash-subtitle">Gerenciamento de Usu√°rios</p>
            <div class="splash-loader"></div>
            <p class="splash-status">Carregando...</p>
        </div>
    </div>

    <!-- LOADING -->
    <div class="loading-overlay" id="loading">
        <div class="loading-spinner"></div>
        <p>Carregando...</p>
    </div>

    <!-- CONTAINER PRINCIPAL -->
    <div class="container admin-container" id="main-container">
        <!-- CABE√áALHO ADMIN -->
        <div class="admin-header">
            <h1>
                <i class="fas fa-user-shield"></i>
                Painel do Supervisor - Gerenciamento de Usu√°rios
            </h1>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="window.location.href='index.html'" 
                        data-tooltip="Voltar ao Sistema">
                    <i class="fas fa-home"></i> <span>Voltar ao Sistema</span>
                </button>
                <button class="btn btn-notificacoes" onclick="mostrarSecao('gerenciar-notificacoes')"
                        data-tooltip="Notifica√ß√µes">
                    <i class="fas fa-bell"></i> <span>Notifica√ß√µes</span>
                </button>
                <button class="btn btn-atualizar" onclick="atualizarDados()"
                        data-tooltip="Atualizar Dados">
                    <i class="fas fa-sync-alt"></i> <span>Atualizar</span>
                </button>
            </div>
        </div>

        <!-- SE√á√ÉO 1: SOLICITA√á√ïES PENDENTES -->
        <div class="admin-section" id="solicitacoes-pendentes">
            <h2><i class="fas fa-clock"></i> Solicita√ß√µes de Acesso Pendentes</h2>
            
            <div class="search-filter">
                <input type="text" class="search-box" id="search-solicitacoes" 
                       placeholder="Buscar por nome ou email..." 
                       onkeyup="filtrarSolicitacoes()">
            </div>
            
            <div class="table-responsive">
                <table class="admin-table" id="tabela-solicitacoes">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>Telefone</th>
                            <th>Mensagem</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="solicitacoes-body">
                        <tr>
                            <td colspan="6" class="loading-admin">
                                <i class="fas fa-spinner fa-spin"></i> Carregando solicita√ß√µes...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div id="solicitacoes-empty" class="empty-state" style="display: none;">
                <i class="fas fa-inbox"></i>
                <h3>Nenhuma solicita√ß√£o pendente</h3>
                <p>Todas as solicita√ß√µes foram processadas.</p>
            </div>
        </div>

        <!-- SE√á√ÉO 2: USU√ÅRIOS CADASTRADOS -->
        <div class="admin-section" id="usuarios-cadastrados">
            <h2><i class="fas fa-users"></i> Usu√°rios Cadastrados</h2>
            
            <div class="search-filter">
                <input type="text" class="search-box" id="search-usuarios" 
                       placeholder="Buscar por nome, email ou departamento..." 
                       onkeyup="filtrarUsuarios()">
                
                <div class="filter-group">
                    <select id="filter-tipo" class="search-box" style="width: auto;" onchange="filtrarUsuarios()">
                        <option value="">Todos os tipos</option>
                        <option value="supervisor">Supervisor</option>
                        <option value="gestor">Diretor(a)</option>
                        <option value="comum">Usu√°rio Comum</option>
                    </select>
                    
                    <select id="filter-departamento" class="search-box" style="width: auto;" onchange="filtrarUsuarios()">
                        <option value="">Todos departamentos</option>
                        <option value="Gest√£o">Gest√£o</option>
                        <option value="Secretaria">Secretaria</option>
                        <option value="Pedag√≥gico">Pedag√≥gico</option>
                        <option value="Supervis√£o">Supervis√£o</option>
                    </select>
                </div>
            </div>
            
            <div class="table-responsive">
                <table class="admin-table" id="tabela-usuarios">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>Tipo</th>
                            <th>Departamento</th>
                            <th>Escola</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="usuarios-body">
                        <tr>
                            <td colspan="7" class="loading-admin">
                                <i class="fas fa-spinner fa-spin"></i> Carregando usu√°rios...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div id="usuarios-empty" class="empty-state" style="display: none;">
                <i class="fas fa-users-slash"></i>
                <h3>Nenhum usu√°rio cadastrado</h3>
                <p>Comece aprovando solicita√ß√µes de acesso.</p>
            </div>
        </div>

        <!-- SE√á√ÉO 3: ESTAT√çSTICAS -->
        <div class="admin-section" id="estatisticas">
            <h2><i class="fas fa-chart-bar"></i> Estat√≠sticas</h2>
            <div class="stats-grid" id="conteudo-estatisticas">
                <div class="loading-admin">
                    <i class="fas fa-spinner fa-spin"></i> Carregando estat√≠sticas...
                </div>
            </div>
        </div>
    </div>
            <!-- SE√á√ÉO 4: GERENCIAR NOTIFICA√á√ïES (NOVA) -->
        <div class="admin-section" id="gerenciar-notificacoes" style="display: none;">
            <h2><i class="fas fa-bell"></i> Gerenciar Notifica√ß√µes</h2>
            
            <div class="configuracoes-notificacoes">
                <h3><i class="fas fa-cog"></i> Configura√ß√µes Gerais</h3>
                
                <div class="config-card">
                    <h4><i class="fas fa-envelope"></i> Notifica√ß√µes por Email</h4>
                    <div class="toggle-group">
                        <label class="toggle">
                            <input type="checkbox" id="toggle-emails" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Enviar emails autom√°ticos</span>
                        </label>
                        
                        <label class="toggle">
                            <input type="checkbox" id="toggle-emails-urgentes" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Emails para demandas urgentes</span>
                        </label>
                    </div>
                </div>
                
                <div class="config-card">
                    <h4><i class="fas fa-mobile-alt"></i> Notifica√ß√µes Push</h4>
                    <div class="toggle-group">
                        <label class="toggle">
                            <input type="checkbox" id="toggle-push" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Notifica√ß√µes no celular</span>
                        </label>
                        
                        <button class="btn-testar btn btn-info" onclick="testarNotificacao()">
                            <i class="fas fa-bell"></i> Testar Notifica√ß√£o
                        </button>
                    </div>
                </div>
                
                <div class="config-card">
                    <h4><i class="fas fa-users"></i> Segmenta√ß√£o por Perfil</h4>
                    <div class="segmentacao">
                        <label class="segmentacao-item">
                            <input type="checkbox" name="segmentacao" value="supervisor" checked>
                            <span class="segmentacao-label">Supervisores (recebem tudo)</span>
                        </label>
                        <label class="segmentacao-item">
                            <input type="checkbox" name="segmentacao" value="diretor" checked>
                            <span class="segmentacao-label">Diretores (apenas sua escola)</span>
                        </label>
                        <label class="segmentacao-item">
                            <input type="checkbox" name="segmentacao" value="comum" checked>
                            <span class="segmentacao-label">Usu√°rios comuns (depto+escola)</span>
                        </label>
                    </div>
                </div>
                
                <div class="config-card">
                    <h4><i class="fas fa-history"></i> Log de Notifica√ß√µes</h4>
                    <div class="logs-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Demanda</th>
                                    <th>Enviadas</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="logs-notificacoes">
                                <tr>
                                    <td colspan="4" class="empty-state">
                                        <i class="fas fa-spinner fa-spin"></i> Carregando logs...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button class="btn-carregar btn btn-secondary" onclick="carregarLogsNotificacoes()" style="margin-top: 10px;">
                        <i class="fas fa-sync-alt"></i> Atualizar Logs
                    </button>
                </div>
            </div>
            
            <div class="acoes-notificacoes" style="margin-top: 20px; text-align: center;">
                
            <button class="btn-voltar btn btn-secondary" onclick="voltarParaSecoesPrincipais()" style="margin-right: 10px;">
                <i class="fas fa-arrow-left"></i> Voltar
            </button>
                
                <button class="btn-salvar btn btn-success" onclick="salvarConfiguracoesNotificacoes()">
                    <i class="fas fa-save"></i> Salvar Configura√ß√µes
                </button>
                
                <button class="btn-testar-tudo btn btn-warning" onclick="testarTodasNotificacoes()" style="margin-left: 10px;">
                    <i class="fas fa-vial"></i> Testar Todas as Notifica√ß√µes
                </button>
            </div>
        </div>
    </div> 

    <!-- MODAL DE AUTORIZA√á√ÉO -->
    <div class="modal-overlay" id="modal-autorizar">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-user-check"></i> Autorizar Usu√°rio</h2>
                <button class="btn-close" onclick="fecharModalAutorizar()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div id="dados-solicitante">
                    <p><strong>Nome:</strong> <span id="modal-nome"></span></p>
                    <p><strong>Email:</strong> <span id="modal-email"></span></p>
                    <p><strong>Telefone:</strong> <span id="modal-telefone"></span></p>
                    <p><strong>Mensagem:</strong> <span id="modal-mensagem"></span></p>
                </div>
                
                <form id="form-autorizar">
                    <input type="hidden" id="modal-email-hidden">
                    
                    <div class="form-group">
                        <label for="modal-tipo"><i class="fas fa-user-tag"></i> Tipo de Usu√°rio *</label>
                        <select id="modal-tipo" class="search-box" required style="width: 100%;">
                            <option value="">Selecione o tipo...</option>
                            <option value="supervisor">Supervisor</option>
                            <option value="gestor">Diretor(a)</option>
                            <option value="comum">Usu√°rio Comum</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="modal-departamento"><i class="fas fa-building"></i> Departamento *</label>
                        <select id="modal-departamento" class="search-box" required style="width: 100%;">
                            <option value="">Selecione o departamento...</option>
                            <option value="Gest√£o">Gest√£o</option>
                            <option value="Secretaria">Secretaria</option>
                            <option value="Pedag√≥gico">Pedag√≥gico</option>
                            <option value="Supervis√£o">Supervis√£o</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="modal-escola"><i class="fas fa-school"></i> Escola *</label>
                        <select id="modal-escola" class="search-box" required style="width: 100%;">
                            <option value="">Selecione a escola...</option>
                            <option value="EEEFM Pedra Azul">EEEFM Pedra Azul</option>
                            <option value="EEEFM Fioravante Caliman">EEEFM Fioravante Caliman</option>
                            <option value="EEEFM Alto Rio Possmoser">EEEFM Alto Rio Possmoser</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="modal-senha"><i class="fas fa-lock"></i> Senha Inicial *</label>
                        <input type="text" id="modal-senha" class="search-box" required 
                               value="123456" style="width: 100%;">
                        <small class="form-help">O usu√°rio receber√° esta senha por e-mail</small>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="fecharModalAutorizar()">
                    Cancelar
                </button>
                <button type="button" class="btn btn-primary" onclick="autorizarUsuario()">
                    <i class="fas fa-check"></i> Autorizar e Enviar Credenciais
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL DE EDI√á√ÉO DE USU√ÅRIO -->
    <div class="modal-overlay" id="modal-editar">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Editar Usu√°rio</h2>
                <button class="btn-close" onclick="fecharModalEditar()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <form id="form-editar">
                    <input type="hidden" id="edit-email-hidden">
                    
                    <div class="form-group">
                        <label for="edit-nome"><i class="fas fa-user"></i> Nome</label>
                        <input type="text" id="edit-nome" class="search-box" style="width: 100%;">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-email"><i class="fas fa-envelope"></i> Email</label>
                        <input type="email" id="edit-email" class="search-box" style="width: 100%;">
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-tipo"><i class="fas fa-user-tag"></i> Tipo de Usu√°rio *</label>
                        <select id="edit-tipo" class="search-box" required style="width: 100%;">
                            <option value="supervisor">Supervisor</option>
                            <option value="gestor">Diretor(a)</option>
                            <option value="comum">Usu√°rio Comum</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-departamento"><i class="fas fa-building"></i> Departamento *</label>
                        <select id="edit-departamento" class="search-box" required style="width: 100%;">
                            <option value="Gest√£o">Gest√£o</option>
                            <option value="Secretaria">Secretaria</option>
                            <option value="Pedag√≥gico">Pedag√≥gico</option>
                            <option value="Supervis√£o">Supervis√£o</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-escola"><i class="fas fa-school"></i> Escola *</label>
                        <select id="edit-escola" class="search-box" required style="width: 100%;">
                            <option value="EEEFM Pedra Azul">EEEFM Pedra Azul</option>
                            <option value="EEEFM Fioravante Caliman">EEEFM Fioravante Caliman</option>
                            <option value="EEEFM Alto Rio Possmoser">EEEFM Alto Rio Possmoser</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-senha"><i class="fas fa-lock"></i> Resetar Senha</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="edit-senha" class="search-box" 
                                   placeholder="Nova senha (opcional)" style="flex: 1;">
                            <button type="button" class="btn btn-secondary" onclick="gerarSenha()">
                                <i class="fas fa-key"></i> Gerar
                            </button>
                        </div>
                        <small class="form-help">Deixe em branco para manter a senha atual</small>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="fecharModalEditar()">
                    Cancelar
                </button>
                <button type="button" class="btn btn-primary" onclick="salvarEdicaoUsuario()">
                    <i class="fas fa-save"></i> Salvar Altera√ß√µes
                </button>
            </div>
        </div>
    </div>

    <!-- MENSAGENS DO SISTEMA -->
    <div class="toast-container" id="toast-container"></div>

    <!-- SCRIPTS -->
   <script src="src/js/googleAppsScript.js"></script>
   <script src="src/js/googleSheets.js"></script>
   <script src="src/js/admin.js"></script>
    
    <!-- SCRIPT PRINCIPAL DO PAINEL ADMIN -->
<script>
// ============================================
// PAINEL DO SUPERVISOR - SCRIPT PRINCIPAL
// Compat√≠vel com sistema existente
// ============================================

document.addEventListener('DOMContentLoaded', async function() {
    console.log('üëë Painel do Supervisor iniciando...');
    
    // 1. Verificar se √© supervisor
    const usuarioSalvo = localStorage.getItem('usuario_demandas');
    if (!usuarioSalvo) {
        window.location.href = 'login.html';
        return;
    }
    
    let usuario = null;
    try {
        usuario = JSON.parse(usuarioSalvo);
        if (usuario.tipo_usuario !== 'supervisor') {
            alert('Apenas supervisores podem acessar este painel.');
            window.location.href = 'index.html';
            return;
        }
    } catch (e) {
        window.location.href = 'login.html';
        return;
    }
    
    // 2. Atualizar nome do usu√°rio
    const userName = document.getElementById('user-name');
    if (userName) {
        userName.textContent = usuario.nome || 'Supervisor';
    }
    
    // 3. Esconder splash screen
    setTimeout(() => {
        const splash = document.getElementById('splash-screen');
        if (splash) {
            splash.classList.add('hidden');
        }
    }, 1000);
    
    // 4. Carregar dados
    await carregarDados();
    
    console.log('‚úÖ Painel do Supervisor pronto!');
});
// ============================================
// FUN√á√ÉO PARA EXCLUIR USU√ÅRIO
// ============================================

async function excluirUsuarioLinha(email, nome) {
  // 1. Confirmar com o supervisor
  const confirmacao = confirm(`‚ö†Ô∏è ATEN√á√ÉO: Excluir usu√°rio permanentemente?\n\n` +
                             `Nome: ${nome}\n` +
                             `Email: ${email}\n\n` +
                             `Esta a√ß√£o n√£o pode ser desfeita!`);
  
  if (!confirmacao) {
    return;
  }
  
  // 2. Mostrar loading
  mostrarLoading(true);
  
  try {
    // 3. Chamar fun√ß√£o para excluir
    const resultado = await AdminSystem.excluirUsuario(email);
    
    // 4. Verificar resultado
    if (resultado.sucesso) {
      // Sucesso: mostrar mensagem e remover linha
      mostrarToast('Sucesso', `Usu√°rio ${nome} exclu√≠do!`, 'success');
      
      // Remover linha visualmente
      removerUsuarioVisual(email);
      
    } else {
      // Erro: mostrar mensagem
      mostrarToast('Erro', resultado.erro || 'Erro ao excluir usu√°rio', 'error');
    }
    
  } catch (erro) {
    console.error('‚ùå Erro na exclus√£o:', erro);
    mostrarToast('Erro', 'Falha na comunica√ß√£o com o servidor', 'error');
  } finally {
    mostrarLoading(false);
  }
}

/**
 * Remove um usu√°rio da tabela visualmente
 */
function removerUsuarioVisual(email) {
  console.log(`Removendo visualmente usu√°rio: ${email}`);
  
  const tbody = document.getElementById('usuarios-body');
  if (!tbody) return;
  
  // Procurar a linha com este email
  const linhas = tbody.getElementsByTagName('tr');
  
  for (let i = 0; i < linhas.length; i++) {
    const celulas = linhas[i].getElementsByTagName('td');
    if (celulas.length >= 2) {
      const emailNaCelula = celulas[1].textContent.trim();
      if (emailNaCelula === email) {
        // Efeito visual antes de remover
        linhas[i].classList.add('removing-row');
        
        // Remover ap√≥s anima√ß√£o
        setTimeout(() => {
          linhas[i].remove();
          
          // Verificar se ficou vazio
          if (tbody.children.length === 0) {
            document.getElementById('usuarios-empty').style.display = 'block';
          }
        }, 500);
        
        break;
      }
    }
  }
}
// ============================================
// FUN√á√ïES DE CARREGAMENTO
// ============================================

async function carregarDados() {
    mostrarLoading(true);
    
    try {
        // 1. Testar conex√£o
        const conexao = await AdminSystem.testarConexao();
        if (!conexao.online) {
            AdminSystem.mostrarToast('Erro', 'Servidor offline', 'error');
            return;
        }
        
        // 2. Carregar solicita√ß√µes pendentes
        await carregarSolicitacoes();
        
        // 3. Carregar usu√°rios cadastrados
        await carregarUsuarios();
        
    } catch (erro) {
        console.error('‚ùå Erro ao carregar dados:', erro);
        AdminSystem.mostrarToast('Erro', 'N√£o foi poss√≠vel carregar os dados', 'error');
    } finally {
        mostrarLoading(false);
    }
}

async function carregarSolicitacoes() {
    try {
        const resultado = await AdminSystem.listarSolicitacoesPendentes();
        
        const container = document.getElementById('solicitacoes-body');
        const emptyState = document.getElementById('solicitacoes-empty');
        
        if (!container) return;
        
        if (!resultado.sucesso || !resultado.solicitacoes || resultado.solicitacoes.length === 0) {
            container.innerHTML = '';
            if (emptyState) emptyState.style.display = 'block';
            
            return;
        }
        
        if (emptyState) emptyState.style.display = 'none';
        
        let html = '';
        resultado.solicitacoes.forEach((solicitacao, index) => {
            const data = AdminSystem.formatarData(solicitacao.data_solicitacao || solicitacao.timestamp);
            
            html += `
                <tr id="solicitacao-${solicitacao.email.replace(/[@.]/g, '-')}">
                    <td>${data}</td>
                    <td><strong>${solicitacao.nome || 'N/A'}</strong></td>
                    <td>${solicitacao.email || 'N/A'}</td>
                    <td>${solicitacao.telefone || 'N/A'}</td>
                    <td>${solicitacao.mensagem || 'Sem mensagem'}</td>
                    <td>
                        <button class="btn btn-success btn-small" onclick="abrirModalAutorizar('${solicitacao.email}', '${solicitacao.nome || ''}', '${solicitacao.telefone || ''}', '${solicitacao.mensagem || ''}')">
                            <i class="fas fa-check"></i> Autorizar
                        </button>
                        <button class="btn btn-danger btn-small" onclick="recusarSolicitacao('${solicitacao.email}')">
                            <i class="fas fa-times"></i> Recusar
                        </button>
                    </td>
                </tr>
            `;
        });
        
        container.innerHTML = html;
        
    } catch (erro) {
        console.error('‚ùå Erro ao carregar solicita√ß√µes:', erro);
    }
}

async function carregarUsuarios() {
    try {
        const resultado = await AdminSystem.listarUsuarios();
        
        const container = document.getElementById('usuarios-body');
        const emptyState = document.getElementById('usuarios-empty');
        
        if (!container) return;
        
        if (!resultado.sucesso || !resultado.usuarios || resultado.usuarios.length === 0) {
            if (emptyState) emptyState.style.display = 'block';
            container.innerHTML = '';
            return;
        }
        
        if (emptyState) emptyState.style.display = 'none';
        
        let html = '';
        resultado.usuarios.forEach((usuario, index) => {
            let tipoClass = 'tipo-comum';
            let tipoTexto = 'Usu√°rio';
            
            if (usuario.tipo_usuario === 'supervisor') {
                tipoClass = 'tipo-supervisor';
                tipoTexto = 'Supervisor';
            } else if (usuario.tipo_usuario === 'gestor') {
                tipoClass = 'tipo-gestor';
                tipoTexto = 'Diretor(a)';
            }
            
            // üî• CORRE√á√ÉO: Usar aspas diferentes para evitar conflito
            // Troque as aspas simples 'comum' por caracteres especiais
            const tipoUsuario = usuario.tipo_usuario || 'comum';
            const nomeUsuario = usuario.nome || '';
            const departamentoUsuario = usuario.departamento || '';
            const escolaUsuario = usuario.escola_sre || '';
            
            html += `
                <tr>
                    <td><strong>${usuario.nome || 'N/A'}</strong></td>
                    <td>${usuario.email || 'N/A'}</td>
                    <td><span class="tipo-badge ${tipoClass}">${tipoTexto}</span></td>
                    <td>${usuario.departamento || 'N/A'}</td>
                    <td>${usuario.escola_sre || 'N/A'}</td>
                    <td>
                        <div class="btn-group">
                            <button class="btn btn-primary btn-small" onclick="abrirModalEditar('${usuario.email}', '${nomeUsuario}', '${tipoUsuario}', '${departamentoUsuario}', '${escolaUsuario}')">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-warning btn-small" onclick="resetarSenhaUsuario('${usuario.email}', '${nomeUsuario}')">
                                <i class="fas fa-key"></i> Resetar Senha
                            </button>
                            <button class="btn btn-danger btn-small" onclick="excluirUsuarioLinha('${usuario.email}', '${usuario.nome || 'N/A'}')">
                                <i class="fas fa-trash"></i> Excluir
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }); // üî• ESTE √â O PAR√äNTESE QUE ESTAVA FALTANDO!
        
        container.innerHTML = html;
        
    } catch (erro) {
        console.error('‚ùå Erro ao carregar usu√°rios:', erro);
    }
}
// ============================================
// FUN√á√ïES DE INTERA√á√ÉO
// ============================================

function abrirModalAutorizar(email, nome, telefone, mensagem) {
    document.getElementById('modal-nome').textContent = nome || 'N/A';
    document.getElementById('modal-email').textContent = email || 'N/A';
    document.getElementById('modal-telefone').textContent = telefone || 'N/A';
    document.getElementById('modal-mensagem').textContent = mensagem || 'Sem mensagem';
    document.getElementById('modal-email-hidden').value = email;
    
    // Resetar formul√°rio
    document.getElementById('modal-tipo').value = 'comum';
    document.getElementById('modal-departamento').value = 'Pedag√≥gico';
    document.getElementById('modal-escola').value = 'EEEFM Pedra Azul';
    document.getElementById('modal-senha').value = AdminSystem.gerarSenhaAleatoria();
    
    document.getElementById('modal-autorizar').style.display = 'flex';
}

function fecharModalAutorizar() {
    document.getElementById('modal-autorizar').style.display = 'none';
}

async function autorizarUsuario() {
    const email = document.getElementById('modal-email-hidden').value;
    const tipo = document.getElementById('modal-tipo').value;
    const departamento = document.getElementById('modal-departamento').value;
    const escola = document.getElementById('modal-escola').value;
    const senha = document.getElementById('modal-senha').value;
    const nome = document.getElementById('modal-nome').textContent;
    
    if (!tipo || !departamento || !escola) {
        AdminSystem.mostrarToast('Valida√ß√£o', 'Preencha todos os campos', 'warning');
        return;
    }
    
    const confirmacao = confirm(`Autorizar usu√°rio?\n\nNome: ${nome}\nEmail: ${email}\nTipo: ${tipo}\nDepartamento: ${departamento}\nEscola: ${escola}`);
    
    if (!confirmacao) return;
    
    mostrarLoading(true);
    
    try {
        const resultado = await AdminSystem.autorizarUsuario(email, nome, tipo, departamento, escola, senha);
        
        if (resultado.sucesso) {
            AdminSystem.mostrarToast('Sucesso', `Usu√°rio ${email} autorizado!`, 'success');
            fecharModalAutorizar();
            
            // Remover visualmente da tabela
            removerSolicitacaoVisual(email);
            
        } else {
            AdminSystem.mostrarToast('Erro', resultado.erro || 'Erro ao autorizar', 'error');
        }
    } catch (erro) {
        AdminSystem.mostrarToast('Erro', 'Falha na comunica√ß√£o', 'error');
    } finally {
        mostrarLoading(false);
    }
}    
    /**
 * Remove uma solicita√ß√£o da tabela visualmente (sem recarregar toda a tabela)
 */

/**
 * Verifica se a tabela ficou vazia e mostra mensagem
 */
async function recusarSolicitacao(email) {
    if (!confirm(`Recusar solicita√ß√£o de ${email}?`)) return;
    
    mostrarLoading(true);
    
    try {
        const resultado = await AdminSystem.recusarSolicitacao(email);
        
        if (resultado.sucesso) {
            AdminSystem.mostrarToast('Sucesso', 'Solicita√ß√£o recusada', 'success');
            
            // Remover visualmente da tabela
            removerSolicitacaoVisual(email);
            
        } else {
            AdminSystem.mostrarToast('Erro', resultado.erro || 'Erro ao recusar', 'error');
        }
    } catch (erro) {
        AdminSystem.mostrarToast('Erro', 'Falha na comunica√ß√£o', 'error');
    } finally {
        mostrarLoading(false);
    }
}
/**
 * Remove uma solicita√ß√£o da tabela visualmente
 */
function removerSolicitacaoVisual(email) {
    console.log(`Removendo visualmente: ${email}`);
    
    const tbody = document.getElementById('solicitacoes-body');
    if (!tbody) return;
    
    // Procurar a linha com este email
    const linhas = tbody.getElementsByTagName('tr');
    
    for (let i = 0; i < linhas.length; i++) {
        const celulas = linhas[i].getElementsByTagName('td');
        if (celulas.length >= 3) {
            const emailNaCelula = celulas[2].textContent.trim();
            if (emailNaCelula === email) {
                // Efeito visual antes de remover
                linhas[i].style.opacity = '0.5';
                linhas[i].style.transform = 'translateX(-20px)';
                
                // Remover ap√≥s anima√ß√£o
                setTimeout(() => {
                    linhas[i].remove();
                    
                    // Verificar se ficou vazio
                    if (tbody.children.length === 0) {
                        document.getElementById('solicitacoes-empty').style.display = 'block';
                    }
                }, 300);
                
                break;
            }
        }
    }
}
function abrirModalEditar(email, nome, tipo, departamento, escola) {
    document.getElementById('edit-email-hidden').value = email; 
    document.getElementById('edit-nome').value = nome || '';
    document.getElementById('edit-email').value = email || '';   
    document.getElementById('edit-tipo').value = tipo || 'comum';
    document.getElementById('edit-departamento').value = departamento || 'Pedag√≥gico';
    document.getElementById('edit-escola').value = escola || 'EEEFM Pedra Azul';
    document.getElementById('edit-senha').value = '';
    
    document.getElementById('modal-editar').style.display = 'flex';
}

function fecharModalEditar() {
    document.getElementById('modal-editar').style.display = 'none';
}

function gerarSenha() {
    document.getElementById('edit-senha').value = AdminSystem.gerarSenhaAleatoria();
}

async function salvarEdicaoUsuario() {
    const emailOriginal = document.getElementById('edit-email-hidden').value;
    const nomeNovo = document.getElementById('edit-nome').value;
    const emailNovo = document.getElementById('edit-email').value;
    const tipo = document.getElementById('edit-tipo').value;
    const departamento = document.getElementById('edit-departamento').value;
    const escola = document.getElementById('edit-escola').value;
    const senha = document.getElementById('edit-senha').value;
    
    // Valida√ß√µes b√°sicas
    if (!nomeNovo || nomeNovo.trim() === '') {
        mostrarToast('Valida√ß√£o', 'O nome n√£o pode ficar em branco', 'warning');
        return;
    }
    
    if (!emailNovo || !emailNovo.includes('@')) {
        mostrarToast('Valida√ß√£o', 'Informe um email v√°lido', 'warning');
        return;
    }
    
    const confirmacao = confirm(`Salvar altera√ß√µes?\n\nNome: ${nomeNovo}\nEmail: ${emailNovo}\nTipo: ${tipo}\nDepartamento: ${departamento}\nEscola: ${escola}\n\nO email antigo era: ${emailOriginal}`);
    
    if (!confirmacao) return;
    
    mostrarLoading(true);
    
    try {
        // üî• CORRE√á√ÉO CR√çTICA: Usar a fun√ß√£o CORRETA de comunica√ß√£o
        const resultado = await enviarParaGoogleAppsScript({
            acao: 'alterarUsuario',
            email_original: emailOriginal,   // Email ORIGINAL para buscar
            email_novo: emailNovo,           // Email NOVO (se mudou)
            nome: nomeNovo,                  // Nome NOVO
            tipo_usuario: tipo,              // Tipo
            departamento: departamento,      // Departamento
            escola_sre: escola,              // Escola
            senha: senha                     // Senha (opcional)
        });
        
        if (resultado.sucesso) {
            mostrarToast('Sucesso', 'Usu√°rio atualizado com sucesso!', 'success');
            fecharModalEditar();
            await carregarUsuarios(); // Recarrega a tabela
        } else {
            mostrarToast('Erro', resultado.erro || 'Erro ao atualizar usu√°rio', 'error');
        }
    } catch (erro) {
        console.error('‚ùå Erro ao salvar edi√ß√£o:', erro);
        mostrarToast('Erro', 'Falha na comunica√ß√£o com o servidor', 'error');
    } finally {
        mostrarLoading(false);
    }
}
    async function resetarSenhaUsuario(email, nome) {
    const novaSenha = prompt(`Nova senha para ${nome} (${email}):`, AdminSystem.gerarSenhaAleatoria());
    
    if (!novaSenha || novaSenha.trim() === '') {
        AdminSystem.mostrarToast('Cancelado', 'Opera√ß√£o cancelada', 'info');
        return;
    }
    
    if (!confirm(`Resetar senha para ${email}?\nNova senha: ${novaSenha}`)) return;
    
    mostrarLoading(true);
    
    try {
        const resultado = await AdminSystem.resetarSenha(email, novaSenha);
        
        if (resultado.sucesso) {
            AdminSystem.mostrarToast('Sucesso', 'Senha resetada!', 'success');
        } else {
            AdminSystem.mostrarToast('Erro', resultado.erro || 'Erro ao resetar senha', 'error');
        }
    } catch (erro) {
        AdminSystem.mostrarToast('Erro', 'Falha na comunica√ß√£o', 'error');
    } finally {
        mostrarLoading(false);
    }
}

// ============================================
// FUN√á√ïES UTILIT√ÅRIAS
// ============================================

function mostrarLoading(mostrar) {
    const loading = document.getElementById('loading');
    const mainContainer = document.getElementById('main-container');
    
    if (loading) {
        loading.style.display = mostrar ? 'flex' : 'none';
    }
    
    if (mainContainer) {
        mainContainer.style.opacity = mostrar ? '0.5' : '1';
        mainContainer.style.pointerEvents = mostrar ? 'none' : 'auto';
    }
}

function atualizarDados() {
    carregarDados();
    AdminSystem.mostrarToast('Atualizado', 'Dados atualizados!', 'success');
}
// ============================================
// FUN√á√ïES UTILIT√ÅRIAS AUXILIARES
// ============================================

function mostrarToast(titulo, mensagem, tipo = 'info') {
    const toastContainer = document.getElementById('toast-container');
    if (!toastContainer) return;
    
    const toast = document.createElement('div');
    toast.className = `toast toast-${tipo}`;
    toast.innerHTML = `
        <strong>${titulo}</strong>
        <p>${mensagem}</p>
    `;
    
    toastContainer.appendChild(toast);
    
    setTimeout(() => {
        toast.classList.add('show');
    }, 10);
    
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 300);
    }, 5000);
}

// ============================================
// FUN√á√ÉO PARA MOSTRAR/ESCONDER SE√á√ïES
// ============================================

function mostrarSecao(secaoId) {
    console.log(`Mostrando se√ß√£o: ${secaoId}`);
    
    // 1. Esconder todas as se√ß√µes
    const todasSecoes = document.querySelectorAll('.admin-section');
    todasSecoes.forEach(secao => {
        secao.style.display = 'none';
    });
    
    // 2. Mostrar a se√ß√£o solicitada
    const secaoParaMostrar = document.getElementById(secaoId);
    if (secaoParaMostrar) {
        secaoParaMostrar.style.display = 'block';
        
        // Se for a se√ß√£o de notifica√ß√µes, carregar dados
        if (secaoId === 'gerenciar-notificacoes') {
            setTimeout(() => {
                carregarDadosNotificacoes();
            }, 100);
        }
    }
    
    // 3. Bot√£o de voltar para se√ß√µes principais
    const voltarBtn = document.getElementById('btn-voltar-secoes');
    if (!voltarBtn && secaoId !== 'gerenciar-notificacoes') {
        // N√£o precisa do bot√£o voltar nas se√ß√µes principais
    }
}

// ============================================
// FUN√á√ïES DE NOTIFICA√á√ïES
// ============================================

/**
 * Carrega dados da se√ß√£o de notifica√ß√µes
 */
async function carregarDadosNotificacoes() {
    console.log('Carregando dados de notifica√ß√µes...');
    
    try {
        // Aqui voc√™ pode adicionar chamadas para buscar dados reais
        // Por enquanto, apenas mostra que est√° funcionando
        mostrarToast('Notifica√ß√µes', 'Carregando configura√ß√µes...', 'info');
        
        // Se voc√™ quiser testar, pode descomentar:
        // await carregarLogsNotificacoes();
        
    } catch (erro) {
        console.error('Erro ao carregar notifica√ß√µes:', erro);
    }
}

/**
 * Carrega logs de notifica√ß√µes (exemplo)
 */
async function carregarLogsNotificacoes() {
    const logsBody = document.getElementById('logs-notificacoes');
    if (!logsBody) return;
    
    // Simula√ß√£o de dados
    const logsExemplo = [
        { data: new Date().toLocaleDateString('pt-BR'), demanda: 'Teste de Sistema', enviadas: 3, status: 'Enviadas' },
        { data: '01/12/2024', demanda: 'Reuni√£o Pedag√≥gica', enviadas: 5, status: 'Enviadas' },
        { data: '30/11/2024', demanda: 'Compra de Material', enviadas: 2, status: 'Pendentes' }
    ];
    
    let html = '';
    logsExemplo.forEach(log => {
        html += `
            <tr>
                <td>${log.data}</td>
                <td>${log.demanda}</td>
                <td>${log.enviadas}</td>
                <td><span class="status-badge ${log.status === 'Enviadas' ? 'status-autorizado' : 'status-pendente'}">${log.status}</span></td>
            </tr>
        `;
    });
    
    logsBody.innerHTML = html;
}

/**
 * Testa notifica√ß√µes
 */
async function testarNotificacao() {
    try {
        if ('Notification' in window) {
            if (Notification.permission === 'granted') {
                // Criar notifica√ß√£o
                const notificacao = new Notification('üîî Teste de Notifica√ß√£o', {
                    body: 'Sistema de Demandas Escolares funcionando!',
                    icon: 'public/icons/192x192.png',
                    badge: 'public/icons/96x96.png'
                });
                
                mostrarToast('Teste', 'Notifica√ß√£o enviada com sucesso!', 'success');
            } else if (Notification.permission === 'default') {
                // Pedir permiss√£o
                const permissao = await Notification.requestPermission();
                if (permissao === 'granted') {
                    testarNotificacao(); // Tentar novamente
                } else {
                    mostrarToast('Permiss√£o', 'Permiss√£o para notifica√ß√µes n√£o concedida', 'warning');
                }
            } else {
                mostrarToast('Permiss√£o', 'Notifica√ß√µes bloqueadas pelo usu√°rio', 'warning');
            }
        } else {
            mostrarToast('Navegador', 'Seu navegador n√£o suporta notifica√ß√µes', 'warning');
        }
    } catch (error) {
        console.error('Erro ao testar notifica√ß√£o:', error);
        mostrarToast('Erro', 'Erro ao testar notifica√ß√£o', 'error');
    }
}

/**
 * Salva configura√ß√µes de notifica√ß√µes
 */
function salvarConfiguracoesNotificacoes() {
    try {
        // Coletar valores dos checkboxes
        const emailsAtivo = document.getElementById('toggle-emails').checked;
        const emailsUrgentes = document.getElementById('toggle-emails-urgentes').checked;
        const pushAtivo = document.getElementById('toggle-push').checked;
        
        console.log('Configura√ß√µes salvas:', {
            emails: emailsAtivo,
            emailsUrgentes: emailsUrgentes,
            push: pushAtivo
        });
        
        // Aqui voc√™ implementaria o envio para o servidor
        // Por enquanto, apenas mostra mensagem
        
        mostrarToast('Sucesso', 'Configura√ß√µes salvas com sucesso!', 'success');
        
    } catch (erro) {
        console.error('Erro ao salvar configura√ß√µes:', erro);
        mostrarToast('Erro', 'Erro ao salvar configura√ß√µes', 'error');
    }
}

/**
 * Testa todas as notifica√ß√µes
 */
async function testarTodasNotificacoes() {
    try {
        mostrarLoading(true);
        
        // Testar notifica√ß√µes push
        mostrarToast('Teste', 'Testando notifica√ß√µes push...', 'info');
        await testarNotificacao();
        
        // Testar emails (simula√ß√£o)
        setTimeout(() => {
            mostrarToast('Teste', 'Testando sistema de emails...', 'info');
        }, 1000);
        
        // Testar segmenta√ß√£o
        setTimeout(() => {
            mostrarToast('Teste', 'Verificando segmenta√ß√£o por perfil...', 'info');
        }, 2000);
        
        setTimeout(() => {
            mostrarToast('Conclu√≠do', 'Todos os testes realizados!', 'success');
            mostrarLoading(false);
        }, 3000);
        
    } catch (erro) {
        console.error('Erro nos testes:', erro);
        mostrarToast('Erro', 'Erro durante os testes', 'error');
        mostrarLoading(false);
    }
}

// ============================================
// BOT√ÉO VOLTAR PARA SE√á√ïES PRINCIPAIS
// ============================================

function voltarParaSecoesPrincipais() {
    // Mostrar todas as se√ß√µes principais
    const secoesPrincipais = [
    'solicitacoes-pendentes',
    'usuarios-cadastrados', 
    'estatisticas'
];
    
    // Primeiro, esconder tudo
    const todasSecoes = document.querySelectorAll('.admin-section');
    todasSecoes.forEach(secao => {
        secao.style.display = 'none';
    });
    
    // Depois, mostrar as principais
    secoesPrincipais.forEach(id => {
        const secao = document.getElementById(id);
        if (secao) {
            secao.style.display = 'block';
        }
    });
}

// ============================================
// EXPORTAR NOVAS FUN√á√ïES PARA USO GLOBAL
// ============================================

window.mostrarSecao = mostrarSecao;
window.carregarLogsNotificacoes = carregarLogsNotificacoes;
window.testarNotificacao = testarNotificacao;
window.salvarConfiguracoesNotificacoes = salvarConfiguracoesNotificacoes;
window.testarTodasNotificacoes = testarTodasNotificacoes;
window.voltarParaSecoesPrincipais = voltarParaSecoesPrincipais;
window.fecharModalAutorizar = fecharModalAutorizar;
window.autorizarUsuario = autorizarUsuario;
window.recusarSolicitacao = recusarSolicitacao;
window.fecharModalEditar = fecharModalEditar;
window.gerarSenha = gerarSenha;
window.salvarEdicaoUsuario = salvarEdicaoUsuario;
window.resetarSenhaUsuario = resetarSenhaUsuario;
window.atualizarDados = atualizarDados;

console.log('‚úÖ Script do painel admin carregado!');
</script>
</body>
</html>
